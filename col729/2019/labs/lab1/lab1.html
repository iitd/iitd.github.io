<html>
<head>
  <title>COL729 Lab 1 : Clang Optimisations</title>
</head>

<body>
  <h1><font color="blue">COL729 Lab 1 : LLVM IR and x86 Assembly</font></h1>

  <h2>Due date - 23:55, 4 February 2019</h2>

  <p>In this assignment, we will examine the effect of different clang optimisation
  levels on the generated LLVM IR and x86 Assembly code</p>

  <h3>Instructions</h3>

  <ul>
    <li>Familiarise yourself with <a href="https://llvm.org/docs/LangRef.html">LLVM
    IR</a> and <a href=http://www.cse.iitd.ac.in/~sbansal/os/ref/ia32-2.pdf>x86 Assembly instuction set</a></li>

    <li style="list-style: none"><br /></li>

    <li>Compile the <a href="examples/">following programs</a> using clang to LLVM IR (bitcode) and 32-bit x86
    assembly. The provided Makefile already contains some commands to compile to LLVM IR and 32-bit x86; you may want to modify/adapt it for your needs. Also to standardize the results, we will be using clang-3.6 version, 32-bit x86 mode and Haswell chip. The recommended procedure to generate the code is:

      <ul>
        <li>You can compile a C program to LLVM bitcode using the following command
          <pre> clang -S -emit-llvm &lt;compiler-options&gt; foo.c </pre>

          <ul>
            <li>Run at different optimisation levels - unoptimised, O1, O2, O3, Ofast, any other
            flags, etc.</li>

            <li>Please check the clang documentation on your own for instructions to run bitcode and flags.</li>
          </ul><br />
        </li>

        <li>You can link multiple bitcode files into a single bitcode file using the
        following command
          <pre>llvm-link foo.bc bar.bc</pre>
        </li>

        <li>You can disassemble a bitcode file using the
        following command
          <pre>llvm-dis < foo.bc > foo.bc.s</pre>
        The output disassembly will be available in <code>foo.bc.s</code>.
        </li>


        <li>Generate code from LLVM bitcode to the target assembly (32-bit or 64-bit
        x86):
          <pre>llc foo.bc</pre>
        </li>

        <li>Generate executable from target assembly using gcc assembler:
          <pre>gcc foo.s -o foo.out</pre>
        </li>

        <li>You can disassemble x86 executable using objdump:
          <pre>objdump -d  < foo.out >  foo.out.dis</pre>
        The output disassembly will be available in <code>foo.out.dis</code>.
        </li>
      </ul>
    </li>
  </ul>
<p>You have been given six programs: <code>gcd</code>, <code>loops</code>, <code>print_arg</code>, <code>emptyloop</code>, <code>fibo_iter</code>, <code>fib</code>. Some of these programs have multiple functions inside them -- you are required to describe all functions in these cases.

<p>For LLVM IR bitcode, you are required to test O0 and O2 optimization levels (see Makefile).

<p>For 32-bit x86, you are required to test O0, O2, and O3 optimization levels (see Makefile).

<p>
  <b>Prepare a report summarizing your findings</b>: Your report should be succinct
  yet insightful. It should have the following information:
<ul>
<li>What is the performance difference you observe across different optimizaion levels at bitcode/assembly level?</li>
<li>For LLVM IR bitcode: Describe the bitcode of each program individually, to explain how the bitcode is achieving the desired logic of the program. Do this for each optimization level. Finally, summarize your impressions about the optimizations performed across O0 and O2 in the IR/bitcode level.</li>
<li>For x86 assembly: Describe the x86 assembly of each program individually, to explain how the assembly code is achieving the desired logic of the program. Do this for O0 and O2 levels (do not need to do this for O3). Finally, summarize your impressions about the optimizations performed across O0 and O2 at the assembly level.</li>
</ul>

</body>
</html>
